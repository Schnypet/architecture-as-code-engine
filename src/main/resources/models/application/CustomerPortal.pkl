module CustomerPortal

amends "../metamodel/ArchitectureMetamodel.pkl"
import "../business/BusinessActors.pkl" as BA
import "../technology/TechnologyInfrastructure.pkl" as TECH

local customerPortal: Application = new {
  uid = "APP02"
  description = "Self-service portal for customer interactions and account management"
  stereoType = "Business Application"
  metadata = Map("owner", "Customer Experience Team", "criticality", "Medium")
  vendor = "Internal"
  lifecycle = "Active"
}

local webFrontend: ApplicationComponent = new {
  uid = "COMP04"
  name = "Web Frontend"
  description = "User interface component for customer interactions"
  componentType = "Frontend"
  technology = "React.js"
}

local authenticationModule: ApplicationComponent = new {
  uid = "COMP05"
  name = "Authentication Module"
  description = "Component handling user authentication and authorization"
  componentType = "Backend"
  technology = "OAuth 2.0"
}

local customerDatabase: ApplicationComponent = new {
  uid = "COMP06"
  name = "Customer Database"
  description = "Database component storing customer profiles and data"
  componentType = "Database"
  technology = "MySQL"
}

local customerWebInterface: ApplicationInterface = new {
  uid = "INTF03"
  description = "Web interface for customer self-service interactions"
  interfaceType = "UI"
  format = "HTML/CSS/JS"
}

local customerAPIInterface: ApplicationInterface = new {
  uid = "INTF04"
  description = "API interface for customer data and operations"
  interfaceType = "API"
  format = "JSON"
}

local customerAccountService: ApplicationService = new {
  uid = "SVC03"
  name = "Customer Account Service"
  description = "Service for managing customer accounts and profiles"
}

local authenticationService: ApplicationService = new {
  uid = "SVC04"
  name = "Authentication Service"
  description = "Service for user authentication and session management"
}

local appToFrontend: Relationship = new {
  uid = "REL10"
  description = "Customer Portal contains Web Frontend component"
  source = customerPortal
  target = webFrontend
}

local appToAuth: Relationship = new {
  uid = "REL11"
  description = "Customer Portal contains Authentication Module component"
  source = customerPortal
  target = authenticationModule
}

local appToCustomerDb: Relationship = new {
  uid = "REL12"
  description = "Customer Portal contains Customer Database component"
  source = customerPortal
  target = customerDatabase
}

local frontendToWebIntf: Relationship = new {
  uid = "REL13"
  description = "Web Frontend exposes Customer Web Interface"
  source = webFrontend
  target = customerWebInterface
}

local authToService: Relationship = new {
  uid = "REL14"
  description = "Authentication Module exposes Authentication Service"
  source = authenticationModule
  target = authenticationService
}

local accountServiceToAPI: Relationship = new {
  uid = "REL15"
  description = "Customer Account Service exposes Customer API Interface"
  source = customerAccountService
  target = customerAPIInterface
}

local frontendToAuth: Relationship = new {
  uid = "REL16"
  description = "Web Frontend uses Authentication Module"
  source = webFrontend
  target = authenticationModule
}

local authToDb: Relationship = new {
  uid = "REL17"
  description = "Authentication Module accesses Customer Database"
  source = authenticationModule
  target = customerDatabase
}

local frontendToAccountService: Relationship = new {
  uid = "REL18"
  description = "Web Frontend uses Customer Account Service"
  source = webFrontend
  target = customerAccountService
}

local customerUsesPortal: Relationship = new {
  uid = "REL19"
  description = "Customer uses Customer Portal for self-service activities"
  source = BA.customer
  target = customerPortal
}

local serviceRepUsesPortal: Relationship = new {
  uid = "REL20"
  description = "Customer Service Representative uses Customer Portal to assist customers"
  source = BA.customerService
  target = customerPortal
}

// ============ TECHNOLOGY RELATIONSHIPS ============

local webFrontendOnLoadBalancer: Relationship = new {
  uid = "REL30"
  description = "Web Frontend deployed on Web Load Balancer"
  source = webFrontend
  target = TECH.webLoadBalancer
}

local authModuleOnAppServer: Relationship = new {
  uid = "REL31"
  description = "Authentication Module deployed on Application Server"
  source = authenticationModule
  target = TECH.applicationServer
}

local customerDbOnDbServer: Relationship = new {
  uid = "REL32"
  description = "Customer Database deployed on Database Server"
  source = customerDatabase
  target = TECH.databaseServer
}

local webFrontendUsesNginx: Relationship = new {
  uid = "REL33"
  description = "Web Frontend uses Nginx Web Server"
  source = webFrontend
  target = TECH.nginxWebServer
}

local customerDbUsesMySQL: Relationship = new {
  uid = "REL34"
  description = "Customer Database uses MySQL"
  source = customerDatabase
  target = TECH.mysqlDatabase
}
